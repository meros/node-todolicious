<link rel="import" href="../bower_components/polymer/polymer.html">  
<link rel="import" href="./todo-keyboard.html">
<link rel="import" href="./todo-viewmodel.html">
<link rel="import" href="./todo-view.html">
  
<script src="http://code.jquery.com/jquery-2.1.4.min.js"></script>

<dom-module id="todo-app">
  <template>
    <!-- Invisible elements -->
    <todo-keyboard id="keyboard" on-pressed-tab="onPressedTab" on-pressed-up="onPressedUp" on-pressed-down="onPressedDown"></todo-keyboard>
    <todo-viewmodel id="viewmodel" model="{{model}}"" on-bullets-updated="onBulletsUpdated"></todo-viewmodel>
    <!-- Visible elements -->
    <todo-view id="view" model="{{model}}"></todo-view>
  </template>
</dom-module>
<script>
  Polymer({
    is: 'todo-app',
    
    properties: {
      model: Object
    },
    
    onPressedTab: function(e, detail) {
      //this.$['rootBullet'].onIndent(detail.shift);
    },
    
    /*getSelectedBulletIndex: function() {
      var bullets = $("todo-bullet");
      var selectedIndex = -1;
      bullets.each(function(index) {
        if ($(this).prop("selected")) {
          selectedIndex = index;
        }
      });
      
      return selectedIndex;
    },*/
    
    onPressedDown: function(e, detail) {
      this.$.viewmodel.selectNext(true);
      /*var selectedIndex = this.getSelectedBulletIndex();
      var bullets =  $("todo-bullet");
      
      $(bullets.get(selectedIndex)).prop("selected", false);
      $(bullets.get((selectedIndex + 1) % bullets.length)).prop("selected", true);*/
    },
     
    onPressedUp: function(e, detail) {
      this.$.viewmodel.selectNext(false);
      /*var selectedIndex = this.getSelectedBulletIndex();
      var bullets =  $("todo-bullet");
      
      $(bullets.get(selectedIndex)).prop("selected", false);
      $(bullets.get((selectedIndex - 1) % bullets.length)).prop("selected", true);*/
    }
  });
</script>